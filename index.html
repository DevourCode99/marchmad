<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Meal Maker App</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Roboto+Condensed:wght@700&display=swap" rel="stylesheet" />
  <style>
    /* Inlined CSS inspired by your provided example */

    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Roboto+Condensed:wght@700&display=swap');

    /* Reset & Base */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(-45deg, #000, #333, #111, #222);
      background-size: 400% 400%;
      animation: gradientAnimation 15s ease infinite;
      color: #fff;
      min-height: 100vh;
    }
    @keyframes gradientAnimation {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    /* Sections */
    .section {
      display: none;
      padding: 20px;
    }
    .menu-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    /* Header for Main Menu */
    .header {
      margin-bottom: 40px;
      text-align: center;
    }
    .header h1 {
      font-family: 'Roboto Condensed', sans-serif;
      font-size: 3rem;
      letter-spacing: 2px;
      text-transform: uppercase;
      margin-bottom: 10px;
    }
    /* (Optional) The header below the title is not needed if each menu card shows time info.
       You may remove this if you prefer the menu cards to be the sole display.
    */
    .header p {
      font-size: 1.5rem;
      letter-spacing: 1px;
    }

    /* Main Menu Items (Cards) – centered */
    .menu-item {
      font-size: 2.5rem;
      font-weight: 700;
      margin: 20px 0;
      padding: 20px;
      border: 2px solid #fff;
      border-radius: 12px;
      transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease, color 0.3s ease;
      cursor: pointer;
      width: 80%;
      max-width: 500px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .menu-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(255,255,255,0.2);
      background-color: #fff;
      color: #000;
    }
    /* Menu item inner text */
    .menu-title {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .menu-dow, .menu-date, .menu-time {
      font-size: 1.2rem;
      margin-bottom: 5px;
    }

    /* Buttons (used for back and navigation in other pages) */
    .back-button, .nav-button {
      font-size: 1rem;
      margin: 10px;
      cursor: pointer;
      padding: 10px 20px;
      border: 2px solid #fff;
      background: #000;
      color: #fff;
      border-radius: 5px;
      transition: all 0.3s ease;
    }
    .back-button:hover, .nav-button:hover {
      background: #fff;
      color: #000;
    }

    /* Live time text on non-main-menu pages */
    .live-time {
      font-size: 1rem;
      margin: 10px 0 20px;
      text-align: left;
    }

    /* Grocery List Section – left aligned for readability */
    #groceryListContainer {
      text-align: left;
      max-width: 600px;
      margin: 20px auto;
    }
    .grocery-category {
      margin-top: 15px;
    }
    .grocery-category h3 {
      color: #fff;
      margin-bottom: 5px;
    }
    .grocery-category ul {
      margin-left: 20px;
      list-style: disc;
    }

    /* Recipe Section – left aligned for readability */
    #recipeInfoContainer {
      margin: 20px auto;
      max-width: 600px;
      text-align: left;
    }
    .recipe-date {
      font-size: 2rem;
      margin: 20px 0;
      font-weight: bold;
      text-align: left;
    }
    .recipe-nav {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 20px;
    }

    /* Mobile adjustments */
    @media (max-width: 600px) {
      .menu-item {
        font-size: 2rem;
        padding: 15px;
      }
      .header h1 {
        font-size: 2.5rem;
      }
      .header p,
      .menu-dow, .menu-date, .menu-time {
        font-size: 1.2rem;
      }
      .back-button, .nav-button {
        font-size: 0.9rem;
        padding: 8px 16px;
      }
    }

    /* Active Section */
    .active {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Main Menu Section (Centered) -->
  <div id="menuSection" class="section menu-container" style="display: flex;">
    <div class="header">
      <h1>Meal Maker App</h1>
      <!-- Optional overall live time header; you may remove if each menu card shows time -->
      <p id="todayTimeHeader"></p>
    </div>
    <!-- Menu Card for Grocery List -->
    <div class="menu-item" id="btnGroceryList">
      <div class="menu-title">Grocery List</div>
      <div class="menu-dow" id="menuGroceryDOW"></div>
      <div class="menu-date" id="menuGroceryDate"></div>
      <div class="menu-time" id="menuGroceryTime"></div>
    </div>
    <!-- Menu Card for Weekly Recipes -->
    <div class="menu-item" id="btnRecipeToday">
      <div class="menu-title">Weekly Recipes</div>
      <div class="menu-dow" id="menuRecipeDOW"></div>
      <div class="menu-date" id="menuRecipeDate"></div>
      <div class="menu-time" id="menuRecipeTime"></div>
    </div>
  </div>

  <!-- Grocery List Section (Left-aligned content) -->
  <div id="grocerySection" class="section">
    <button class="back-button" id="backFromGrocery">Back to Menu</button>
    <p id="groceryLiveTime" class="live-time"></p>
    <h2>Grocery List</h2>
    <div id="groceryListContainer"></div>
  </div>

  <!-- Recipe Section (Left-aligned content) -->
  <div id="recipeSection" class="section">
    <button class="back-button" id="backFromRecipe">Back to Menu</button>
    <p id="recipeLiveTime" class="live-time"></p>
    <h2>Weekly Recipes</h2>
    <!-- Large scheduled date appears here -->
    <div id="recipeScheduledDate" class="recipe-date"></div>
    <div id="recipeInfoContainer"></div>
    <div class="recipe-nav">
      <button class="nav-button" id="prevRecipe">Prev Recipe</button>
      <button class="nav-button" id="nextRecipe">Next Recipe</button>
    </div>
  </div>

  <script>
    // Global variables
    let currentGroupNumber = null;
    let currentRecipeNumber = null; // from pull.json (may be null on grocery days)
    let isGroceryDay = false;
    let recipeArray = []; // holds recipes from the appropriate recN.json file
    let currentRecipeIndex = 1; // carousel index from 1 to 6 (default to today's recipe if available)

    // HTML element references for sections
    const menuSection = document.getElementById("menuSection");
    const grocerySection = document.getElementById("grocerySection");
    const recipeSection = document.getElementById("recipeSection");

    // Main Menu header element (optional live header)
    const todayTimeHeader = document.getElementById("todayTimeHeader");
    // Main Menu card elements
    const menuGroceryDOW = document.getElementById("menuGroceryDOW");
    const menuGroceryDate = document.getElementById("menuGroceryDate");
    const menuGroceryTime = document.getElementById("menuGroceryTime");

    const menuRecipeDOW = document.getElementById("menuRecipeDOW");
    const menuRecipeDate = document.getElementById("menuRecipeDate");
    const menuRecipeTime = document.getElementById("menuRecipeTime");

    // Live time elements on other pages
    const groceryLiveTimeElem = document.getElementById("groceryLiveTime");
    const recipeLiveTimeElem = document.getElementById("recipeLiveTime");

    // Other element references
    const groceryListContainer = document.getElementById("groceryListContainer");
    const recipeInfoContainer = document.getElementById("recipeInfoContainer");
    const recipeScheduledDateElem = document.getElementById("recipeScheduledDate");

    const btnGroceryList = document.getElementById("btnGroceryList");
    const btnRecipeToday = document.getElementById("btnRecipeToday");

    const backFromGrocery = document.getElementById("backFromGrocery");
    const backFromRecipe = document.getElementById("backFromRecipe");

    const prevRecipeBtn = document.getElementById("prevRecipe");
    const nextRecipeBtn = document.getElementById("nextRecipe");

    // Utility: Show only the given section
    function showSection(sectionElem) {
      [menuSection, grocerySection, recipeSection].forEach(sec => sec.style.display = "none");
      sectionElem.style.display = "block";
    }

    // Utility: Get current CST time and return an object with parts
    function getCurrentCSTParts() {
      const now = new Date();
      const cstString = now.toLocaleString("en-US", { timeZone: "America/Chicago" });
      const cstDate = new Date(cstString);
      const dow = cstDate.toLocaleDateString("en-US", { weekday: "long", timeZone: "America/Chicago" });
      const date = cstDate.toLocaleDateString("en-US", { month:"2-digit", day:"2-digit", year:"numeric", timeZone:"America/Chicago" });
      const time = cstDate.toLocaleTimeString("en-US", { hour:"2-digit", minute:"2-digit", second:"2-digit", hour12:true, timeZone:"America/Chicago" });
      return { dow, date, time };
    }

    // Utility: Get full formatted live CST time (for header)
    function getLiveCST() {
      const parts = getCurrentCSTParts();
      return `${parts.date} – ${parts.dow} – ${parts.time} CST`;
    }

    // Update the live time in all pages (menu header and page live time fields)
    function updateLiveTimeDisplays() {
      const parts = getCurrentCSTParts();
      const fullLive = getLiveCST();
      if (todayTimeHeader) {
        todayTimeHeader.textContent = fullLive;
      }
      // Update main menu cards
      if (menuGroceryDOW) menuGroceryDOW.textContent = parts.dow;
      if (menuGroceryDate) menuGroceryDate.textContent = parts.date;
      if (menuGroceryTime) menuGroceryTime.textContent = parts.time + " CST";

      if (menuRecipeDOW) menuRecipeDOW.textContent = parts.dow;
      if (menuRecipeDate) menuRecipeDate.textContent = parts.date;
      if (menuRecipeTime) menuRecipeTime.textContent = parts.time + " CST";
      
      // Update live time on grocery and recipe pages
      if (groceryLiveTimeElem) groceryLiveTimeElem.textContent = fullLive;
      if (recipeLiveTimeElem) recipeLiveTimeElem.textContent = fullLive;
    }
    setInterval(updateLiveTimeDisplays, 1000);
    updateLiveTimeDisplays();

    // Utility: Get a Date object for today (at midnight CST)
    function getTodayCSTDate() {
      const now = new Date();
      const cstString = now.toLocaleString("en-US", { timeZone: "America/Chicago" });
      const cstDate = new Date(cstString);
      return new Date(cstDate.getFullYear(), cstDate.getMonth(), cstDate.getDate());
    }

    // ------------------ Grocery List ------------------
    async function loadGroceryList() {
      try {
        // Fetch grocery schedule dates from year.json
        const dateRange = await getGroceryDateRange();
        let headingText = "";
        if (dateRange) {
          headingText = `Grocery List for ${dateRange.start} – ${dateRange.end}`;
        } else {
          headingText = `Grocery List for Group ${currentGroupNumber}`;
        }
        let html = `<p>${headingText}${isGroceryDay ? " – (It’s Grocery Day!)" : ""}</p>`;
        // Fetch the grocery list
        const response = await fetch("data/grocery_list.json");
        const data = await response.json();
        if (!data.groceryLists) return;
        const groupData = data.groceryLists.find(g => g.groupNumber === currentGroupNumber);
        if (!groupData) {
          groceryListContainer.innerHTML = "<p>No grocery list found for this group.</p>";
          return;
        }
        html += createGroceryCategoryHTML("Produce", groupData.produce);
        html += createGroceryCategoryHTML("Meat/Poultry", groupData.meatPoultry);
        html += createGroceryCategoryHTML("Canned/Packaged/Dry Goods", groupData.cannedPackagedDryGoods);
        groceryListContainer.innerHTML = html;
      } catch (error) {
        console.error("Error loading grocery list:", error);
        groceryListContainer.innerHTML = "<p>Error loading grocery list. See console for details.</p>";
      }
    }
    function createGroceryCategoryHTML(title, items) {
      if (!items || !Array.isArray(items)) return "";
      return `
        <div class="grocery-category">
          <h3>${title}</h3>
          <ul>
            ${items.map(item => `<li>${item}</li>`).join("")}
          </ul>
        </div>
      `;
    }
    // Fetch grocery date range from year.json based on today's date
    async function getGroceryDateRange() {
      try {
        const response = await fetch("data/year.json");
        const data = await response.json();
        const schedule = data.mealSchedule2025;
        const today = getTodayCSTDate();
        let foundBlock = null;
        for (let month in schedule) {
          for (let block of schedule[month]) {
            const start = new Date(block.startDate);
            const end = new Date(block.endDate);
            if (today >= start && today <= end) {
              foundBlock = block;
              break;
            }
          }
          if (foundBlock) break;
        }
        if (foundBlock) {
          const startStr = new Date(foundBlock.startDate).toLocaleDateString("en-US", {month:"2-digit", day:"2-digit", year:"numeric"});
          const endStr = new Date(foundBlock.endDate).toLocaleDateString("en-US", {month:"2-digit", day:"2-digit", year:"numeric"});
          return { start: startStr, end: endStr };
        } else {
          return null;
        }
      } catch (error) {
        console.error("Error fetching year.json for grocery range:", error);
        return null;
      }
    }

    // ------------------ Recipe Carousel ------------------
    async function loadRecipeCarousel() {
      if (!currentRecipeNumber) currentRecipeIndex = 1;
      else currentRecipeIndex = currentRecipeNumber;
      try {
        const fileName = `data/rec${currentGroupNumber}.json`;
        const response = await fetch(fileName);
        const data = await response.json();
        if (!data.recipes) {
          recipeInfoContainer.innerHTML = "<p>No recipes available for this group.</p>";
          return;
        }
        recipeArray = data.recipes;
        displayRecipe(currentRecipeIndex);
      } catch (error) {
        console.error("Error loading recipes:", error);
        recipeInfoContainer.innerHTML = "<p>Error loading recipe. See console for details.</p>";
      }
    }
    function displayRecipe(recipeNum) {
      const recipeData = recipeArray.find(r => r.recipeNumber === recipeNum);
      if (!recipeData) {
        recipeInfoContainer.innerHTML = "<p>Recipe data not found.</p>";
        return;
      }
      // Compute scheduled date assuming today's recipe is from pull.json
      const offsetDays = recipeNum - (currentRecipeNumber || 1);
      const todayCST = getTodayCSTDate();
      const scheduledDate = new Date(todayCST.getTime() + offsetDays * 24 * 3600 * 1000);
      const options = { weekday: "long", month: "2-digit", day: "2-digit", year:"numeric" };
      const scheduledStr = scheduledDate.toLocaleDateString("en-US", options);
      recipeScheduledDateElem.textContent = scheduledStr + (offsetDays === 0 ? " (Today)" : "");

      let html = `<h3>${recipeData.recipeName}</h3>`;
      html += `<p><strong>Prep Time:</strong> ${recipeData.prepTime || ""}</p>`;
      html += `<h4>Ingredients:</h4>`;
      html += `<ul>${(recipeData.ingredientsNeeded || []).map(ing => `<li>${ing}</li>`).join("")}</ul>`;
      html += `<h4>Steps:</h4>`;
      html += `<ol>${(recipeData.steps || []).map(step => `<li>${step}</li>`).join("")}</ol>`;
      recipeInfoContainer.innerHTML = html;

      prevRecipeBtn.disabled = (recipeNum <= 1);
      nextRecipeBtn.disabled = (recipeNum >= 6);
    }

    // ------------------ Initialize App ------------------
    async function initializeApp() {
      // Set main menu header live time
      todayTimeHeader.textContent = getLiveCST();
      try {
        const response = await fetch("data/pull.json");
        const pullData = await response.json();
        const todayStr = new Date(new Date().toLocaleString("en-US", { timeZone: "America/Chicago" }))
                         .toISOString().split('T')[0];
        const foundEntry = pullData.dailySchedule.find(entry => entry.date === todayStr);
        if (!foundEntry) {
          console.warn("No matching entry found in pull.json; defaulting to Group 1.");
          currentGroupNumber = 1;
          currentRecipeNumber = null;
          isGroceryDay = false;
        } else {
          currentGroupNumber = foundEntry.groupNumber;
          currentRecipeNumber = foundEntry.recipeNumber;
          isGroceryDay = foundEntry.groceryDay;
        }
      } catch (error) {
        console.error("Error reading pull.json:", error);
        currentGroupNumber = 1;
        currentRecipeNumber = null;
        isGroceryDay = false;
      }
    }

    // ------------------ Event Listeners ------------------
    btnGroceryList.addEventListener("click", () => {
      showSection(grocerySection);
      loadGroceryList();
    });
    btnRecipeToday.addEventListener("click", () => {
      showSection(recipeSection);
      loadRecipeCarousel();
    });
    backFromGrocery.addEventListener("click", () => showSection(menuSection));
    backFromRecipe.addEventListener("click", () => showSection(menuSection));
    prevRecipeBtn.addEventListener("click", () => {
      if (currentRecipeIndex > 1) {
        currentRecipeIndex--;
        displayRecipe(currentRecipeIndex);
      }
    });
    nextRecipeBtn.addEventListener("click", () => {
      if (currentRecipeIndex < 6) {
        currentRecipeIndex++;
        displayRecipe(currentRecipeIndex);
      }
    });

    // ------------------ Start ------------------
    initializeApp();
    showSection(menuSection);
  </script>
</body>
</html>
